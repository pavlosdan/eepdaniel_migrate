id: eepdaniel_migrate_media

label: 'Import media from eepdaniel'

migration_group: eepdaniel_migrate_articles

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json

  urls: http://eepdanieldev.prod.acquia-sites.com/jsonapi/media/image
  item_selector: data/

  ids:
    id:
      type: string
  
  fields:
    -
      name: id
      label: 'Id'
      selector: /id
    -
      name: name
      label: 'name'
      selector: /attributes/name
    -
      name: status
      label: 'Status'
      selector: /attributes/status
    
    -
      name: created
      label: 'Created'
      selector: /attributes/created

    -
      name: image_id
      label: 'Image file ID'
      selector: /relationships/image/data/id

    -
      name: image_alt
      label: 'Image Alt text'
      selector: /relationships/image/data/meta/alt

process:
  name: name

  bundle:
    plugin: default_value
    default_value: image

  image/target_id:
    plugin: migration_lookup
    migration: eepdaniel_migrate_files
    source: image_id

  image/alt: image_alt


destination:
  plugin: 'entity:media'
  default_bundle: image

migration_dependencies:
  required:
    - eepdaniel_migrate_files

